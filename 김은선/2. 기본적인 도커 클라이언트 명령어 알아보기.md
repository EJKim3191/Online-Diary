
## 1강 복습

### 1. 도커 이미지 복습

- docker : docker client
- run : 컨테이너 생성 및 실행
- 이미지 이름 : 이 컨테이너를 위한 이미지

### ⇒ `docker run hello-world`

### 2. 작동 순서 복습

1. 도커 클라이언트에 명령어 입력 후 도커 서버로 보냄
2. 도커 서버에서 컨테이너를 위한 이미지가 이미 캐시되어있는지 확인
    1. 없다면 도커 허브에서 다운받아옴
3. 다운받은 이미지로 컨테이너 생성

### 이미지로 컨테이너 생성하는 순서 복습

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/366d54b7-ac0b-4814-9a90-41d5173d1504/Untitled.png)

1. 파일 스냅샷을 컨테이너의 하드디스크에 올린다
2. 시작 커맨드를 이용하여 어플리케이션 실행
3. 커널을 통해 프로세스를 실행하는 데 필요한 것들에 명령어 전달해 프로세스 실행

## 1. 도커 이미지 내부 파일 구조 보기

### `docker run <이미지> ls`

- ls : 현재 디렉토리의 파일 리스트 표출
- 명령어의 네 번째 자리 : 원래 이미지가 가지고 있는 시작 명령어를 무시하고 해당 위치에 있는 커맨드를 실행하게 함

### ex. alpine

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/d37361f3-dd51-456f-994e-143aab33ec3c/Untitled.png)

### ex. hello-world

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4d3db9e6-bc57-4471-89f3-6b769b17cd76/Untitled.png)

### hello-world는 왜 ls 명령어가 불가능한가?

- alpine 이미지 안에는 ls를 실행할 수 있는 파일이 있음
- hello-world 이미지 안에는 ls를 실행할 수 있는 파일이 존재하지 않음
    - hello-world는 굉장히 작은 이미지...

### ⇒ 이미지가 가지고 있는 파일 스냅샷의 종류에 따라 사용 가능한 명령어가 있고 불가능한 명령어가 있다

## 2. 컨테이너들 나열하기

### 현재 실행중인 컨테이너 나열

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5ce4bbef-65c5-4718-afeb-300825162958/Untitled.png)

### 실습

1. 두 개의 terminal 작동
    1. 하나로는 컨테이너 실행, 하나로는 `docker ps` 명령어 실행해서 작동하는거 확인
2. `docker run alpine ping localhost`
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/062fdfed-c743-4e7f-a550-0ed4c8b2f17b/Untitled.png)
    
3. 다른 terminal에서 `docker ps`
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/671aad4a-8f20-47c1-b771-854435910325/Untitled.png)
    

### 이미지 항목 설명

1. CONTAINER ID : 컨테이너의 고유한 아이디 해쉬값의 일부
2. IMAGE : 컨테이너 생성 시 사용한 도커 이미지
3. COMMAND : 컨테이너 시작 시 실행될 명령어
    1. 대부분 이미지에 내장되어 있음 (시작 명령어)
    2. run 명령어의 네 번째 자리에 입력한 명령어가 있을 경우 들ㅇ너감
4. CREATED : 컨테이너가 생성된 시간
5. STATUS : 컨테이너 상태
    1. UP : 실행중
    2. EXITED : 종료
    3. PAUSE : 일시정지
6. PORTS : 컨테이너가 개방한 포트와 호스트에 연결한 포트
    1. 특별한 설정을 하지 않은 경우 미출력(후술)
7. NAME : 컨테이너 고유 이름
    1. 컨테이너 생성 시 `--name` 옵션으로 지정하지 않을 경우 임의로 ㅁ생성됨
    2. id와 마찬가지로 중복 불가

### 원하는 항목만 보기

`--format` 명령어 사용

`docker ps --format 'table{{.Names}}\ttable{{.Image}}'`

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c421abfc-d924-4e6e-8e4c-da5112f661c2/Untitled.png)

`docker ps --format '{{.Names}}\t{{.Images}}'`

왜 나는 위에 항목의 이름이 나오지 않는가

### 모든 컨테이너 나열

`docker ps -a`

종료된 컨테이너도 볼 수 있다

## 3. 도커 컨테이너의 생명 주기 (3-5)

- 중요한 명령어(일부)

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/5c340dc4-9436-4761-94e6-0e7ff8f12d14/Untitled.png)

### `docker run`의 두 부분

1. 생성 = `docker create` + 이미지 이름
    1. 이미지에 있는 파일 스냅샷을 하드디스크로 옮김
    2. 생성된 컨테이너 아이디는 굉장히 길다 → 앞부분 일부만 사용
2. 실행 = `docker start` + 컨테이너/아이디 이름
    1. 하드디스크에 있는 컨테이너 아이디나 이름을 넣어서 실행
    2. 컨테이너에 시작시 실행될 명령어 (`run`)이 컨테이너에 들어감

### `-a` = attach

- 화면에 output을 같이 표출한다
- ⇒ `docker start -a <컨테이너 id 일부>`

## 4. Docker Stop vs Docker Kill

### `docker stop`

- 하던 일을 마무리하고(메세지를 보내고 있다면 마저 보냄) 멈춤

### `docker kill`

- 컨테이너 바로 중지

## 5. 컨테이너 삭제하기

### `docker rm <컨테이너 아이디/이름>`

- 실행중인 컨테이너는 **먼저 중지**한 뒤에 삭제 가능

### 모든 컨테이너를 삭제하고 싶다면?

### 오류

- `docker rm 'docker ps -a -q'`
    
    → 윈도우에서는 이게 아니라고 함
    
- `docker ps -aq | xargs -n 1 docker rm`
- `docker rm $(docker ps -a -q)`
    - 둘 다 실패
- docker rm `docker ps a q`
    - 작은따옴표가 아니고 백틱 → 실패

### 해결

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a03e2a8d-ec6d-4f8b-a42b-74eb95a6f8b5/Untitled.png)

### `FOR /f "tokens=*" %i IN ('docker ps -a -q') DO docker rm %i`

for문으로 실행하는 형식이라고 함

참고 링크 : [https://mesure.tistory.com/entry/windowsdocker-컨테이너-이미지-모두-삭제](https://mesure.tistory.com/entry/windowsdocker-%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EC%9D%B4%EB%AF%B8%EC%A7%80-%EB%AA%A8%EB%91%90-%EC%82%AD%EC%A0%9C)

### 이미지를 삭제하고 싶다면?

`docker rmi <이미지 id>`

### 한 번에 컨테이너, 이미지, 네트워크 모두 삭제하고 싶다면?

`docker system prune`

- 도커를 쓰지 않을 때 사용
- 이것도 실행중인 컨테이너에는 영향을 주지 않음

## 6. 실행중인 컨테이너에 명령어 전달

### `docker exec <컨테이너 아이디>`

1. terminal 두 개 실행
2. 첫 번째 터미널에서 컨테이너 하나 실행
3. 두 번째 터미널에서 다른 명령어 전달

### run vs exec

1. `docker run`은 새로 컨테이너를 만들어서 실행
2. `docker exec`는 이미 실행중인 컨테이너에 명령어 전달

## 7. 레디스를 이용한 컨테이너 이해

### 레디스 작동 순서

1. 레디스 서버 작동 확인
    1. `docer run redis`
2. 레디스 클라이언트 실행
    1. `rdeis-cli`
3. 명령어 입력
    1. `set value1 hello`
4. 레디스 서버에 전달

### 실습!

1. 터미널 1 오픈
    1. docker run redis
    2. 아무것도 입력할 수 없음
2. 터미널 2 오픈
    1. 명령어 입력하면 에러

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/15e41964-d27c-4321-977e-653c18817607/Untitled.png)

- 레디스 클라이언트가 레디스 서버가 있는 컨테이너 외부에서 접근을 하려고 해서 connection refused 에러 발생
    - ⇒ 레디스 클라이언트도 컨테이너 안에서 실행해야 함

### `docker esec -it <컨테이너 아이디> redis-cli`

- `-it` 명령어
    - 명령어를 실행한 뒤에 계속 명령어를 적을 수 있게 해줌
    - -i : interactive 상호적인
    - -t : terminal
    - -it를 입력하지 않으면 redis-cli 클라이언트 생성하고 밖으로 나옴
        - redis cli에 다음 명령어를 입력할 수 없음 (다음 명령어 전달 불가)
1. terminal 1에 redis 실행
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/b907e015-34c3-49b2-90e1-6e7991c95bdc/Untitled.png)
    
2. terminal 2에서 redis-cli에 redis 명령어 입력
    
    ![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/90c1554b-df0b-44cc-93cd-99ab94ed1412/Untitled.png)
    

## 8. 실행 중인 컨테이너에서 터미널 생활 즐기기

- ~7챕터까지는 실행중인 컨테이너에 명령어를
    - `docker exec -it <컨테이너 아이디> 명령어` 방식으로 전달
    - 컨테이너 안에 쉘이나 터미널 환경으로 접속할 수 있음

### `docker exec -it <컨테이너 아이디> sh`

- sh, bash, zsh, powershell 등 사용 가능
    - 이미지 마다 가능/불가능 여부가 다르다
    - sh : window, macos
    - bash, zsh : macos
    - powershell : window

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/a8e5ed70-dcdb-4d47-9ec7-cb83004a5387/Untitled.png)

docker exec -it <컨테이너 아이디> 부분을 항상 입력하지 않아도 됨

- sh에서 빠져나오는 명령어 : `ctrl + d`
